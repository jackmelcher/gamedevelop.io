<!DOCTYPE html>
<html>
    <head>
        <title>Codevelup Resources</title>
        <!-- Site Settings -->
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="UTF-8">
        <meta name="viewport" content="height=device-height, 
            width=device-width, initial-scale=1.0, 
            minimum-scale=1.0, maximum-scale=1.0, 
            user-scalable=no, width=device-width">
        
        <!-- Google Fonts -->
        <link href="https://fonts.googleapis.com/css?family=Quicksand|Roboto" rel="stylesheet">  

        <!-- Font Awesome -->
        <link rel="stylesheet" href="fontawesome-free-5.12.1-web/css/all.min.css">   
        
        <!-- Favicons -->
        <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
        <link rel="manifest" href="favicons/site.webmanifest">
        <link rel="mask-icon" href="favicons/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="theme-color" content="#ffffff">
        
        <!-- Style -->
        <link rel="stylesheet" type="text/css" href="stylesheet.css">
        
        <!-- Scripts -->
        <script src="papaparse.min.js"></script> 
    </head>

    <!-- Make function that retrieves favicons of websites and saves them to local folder. -->
    <body>
        <nav class="navbar">
            <button class="button buttonside sidenavbutton" onclick="ToggleSide()">
                <i class="menuicon fas fa-bars"></i>
            </button>
            <a href="index.html" class="button button_logo">
                <img src="images/logo.svg" alt="logo" class="logoimg">
            </a>
            <a href="resources.html" class="button button_nav">
                Resources
            </a>
            <a href="guides.html" class="button button_nav">
                Guides
            </a>
        </nav>
        
        <section class="sectionlimited">
            <div class="sidenav">
                Category: 
                <br>
                <div>
                    <select id="category" onchange="SelectTable(this.value)">
                        <option id="emptyCategory" selected="selected" disabled>Select a Category</option>
                        <optgroup label="Software & Tools"> 
                            <option value="2d">2D Art</option>
                            <option value="3d">3D Art</option>
                            <option value="analytics">Analytics</option>
                            <option value="audio">Audio</option>
                            <option value="communication">Communication</option>
                            <option value="engine">Engines and Frameworks</option>
                            <option value="monetization">Monetization</option>
                            <option value="other">Other Tools</option>
                            <option value="sdk">SDKs</option>
                            <option value="security">Security</option>
                            <option value="tasking">Tasking and Collaboration</option>
                            <option value="vcs">Version Control Software</option>
                            <option value="vcsgui">VCS GUI</option>
                            <option value="vcshosts">VCS Hosting</option>
                            <option value="video">Video</option>
                            <option value="writing">Writing</option>
                        </optgroup>
                        <optgroup label="Assets & Services">
                            <option value="assets">Assets</option>
                            <option value="services">Services</option>
                        </optgroup>
                        <optgroup label="Hardware & Peripherals">
                            <option value="hardware">Hardware</option>
                            <option value="peripherals">Peripherals</option>
                        </optgroup>
                        <optgroup label="Publishing & Distribution">
                            <option value="funding">Funding Options</option>
                            <option value="gamehosts">Hosting & Storefronts</option>
                            <option value="news">News Outlets</option>
                            <option value="publisher">Publishers</option>
                        </optgroup> 
                        <optgroup label="Learning & Communities">
                            <option value="communities">Communities</option>
                            <option value="conventions">Conventions</option>
                            <option value="jams">Game Jams</option>
                            <option value="jobs">Job Boards</option>
                            <option value="learning">Learning Websites</option>
                            <option value="schools">Schools</option>
                        </optgroup>
                    </select>
                </div>
                <br>
                <div>
                    Filters:
                    <div>
                        <p class="listTitle">Price:</p>
                        <ul class="nobullets">
                            <li>
                                <input type="checkbox" name="price" value="free" onclick="FilterTable()">
                                <label for="price">Free</label>
                            </li>
                            <li>
                                <input type="checkbox" name="price" value="trial" onclick="FilterTable()">
                                <label for="price">Trial</label>
                            </li>
                            <li>
                                <input type="checkbox" name="price" value="paid" onclick="FilterTable()">
                                <label for="price">Paid</label>
                            </li>
                            <li>
                                <input type="checkbox" name="price" value="subscription" onclick="FilterTable()">
                                <label for="price">Subscription</label>
                            </li>
                            <li>
                                <input type="checkbox" name="price" value="royalty" onclick="FilterTable()">
                                <label for="price">Royalty</label>
                            </li>
                            <li>
                                <input type="checkbox" name="price" value="license" onclick="FilterTable()">
                                <label for="price">License</label>
                            </li>
                        </ul>    
                    </div>

                    <div>
                        <p class="listTitle">Platform:</p>
                        <ul class="nobullets">
                            <li>
                                <input type="checkbox" name="platform" value="windows" onclick="FilterTable()">
                                <label for="platform">Windows</label>
                            </li>
                            <li>
                                <input type="checkbox" name="platform" value="mac" onclick="FilterTable()">
                                <label for="platform">Mac</label>
                            </li>
                            <li>
                                <input type="checkbox" name="platform" value="linux" onclick="FilterTable()">
                                <label for="platform">Linux</label>
                            </li>
                            <li>
                                <input type="checkbox" name="platform" value="ios" onclick="FilterTable()">
                                <label for="platform">iOS</label>
                            </li>
                            <li>
                                <input type="checkbox" name="platform" value="android" onclick="FilterTable()">
                                <label for="platform">Android</label>
                            </li>
                            <li>
                                <input type="checkbox" name="platform" value="web" onclick="FilterTable()">
                                <label for="platform">Web</label>
                            </li>
                        </ul>    
                    </div>    
                </div>    
            </div>
                
            <div class="resource">
                <h1 id="tname"></h1>
                <div id="showData">
                    <!-- Table is added here 
                    <table>
                        <tr>
                            <td>
                                dfasfadf
                            </td>
                            <td>
                                fdasfa
                            </td>
                            <td>
                                fdsgds
                            </td>
                        </tr>
                    </table>
                    -->
                </div>
            </div>
        </section>  
    </body>

    <script>
        var filepath;
        var csvdata;

        //Run functions when the page is refreshed.
        SelectTable(document.getElementById("category").value);
        FilterTable();
        SetTableName();

        function SelectTable(filename)
        {
            console.log("Select table called");
            
            if(document.getElementById("emptyCategory").style.display == ""){
                document.getElementById("emptyCategory").style.display = "none";
            }

            //filepath = "csv/"+ doc.getElementById("category").value;
            filepath = "csv/"+filename+".csv";
            //document.getElementById("demo").innerHTML = filepath;

            //Clear HTML Data Table
            document.getElementById("showData").innerHTML = "";
            
            //Load CSV Data
            if(filename != document.getElementById("emptyCategory").value){
                LoadDoc(filepath, CreateTableFromArray2D);
            }
            //Update Table Name
            SetTableName();
            imgPlaceholder();
        }
        
        function LoadDoc(filepath, callback) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    //document.getElementById("papa").innerHTML = this.responseText;
                    csvdata = Papa.parse(this.responseText);
                    //console.log(csvdata);
                    callback(csvdata.data);
                }
            };
            xhttp.open("GET", filepath, true);
            xhttp.send();
        }

        function CreateTableFromArray2D(array2D)
        {
            // CREATE DYNAMIC TABLE.
            var table = document.createElement("table");
            table.setAttribute("id", "myTable");

            // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

            for(var i = 0; i < array2D.length; i++)
            {
                var tr = table.insertRow(-1);                       // TABLE ROW.

                for(var j = 0; j < array2D[i].length; j++)
                {
                    if(i == 0)
                    {
                        if(j==1){continue;}                         // Dont make Table Cell for Links column.
                        var th = document.createElement("th");      // TABLE HEADER.
                        th.innerHTML = array2D[i][j];
                        tr.appendChild(th);
                    }
                    else
                    {
                        if(j==1){continue;}                         // Dont make Table Cell for Links column.
                        var tabCell = tr.insertCell(-1);            // TABLE Cell.
                        if(j==0){   
                            var img = document.createElement("img");
                            img.src = "images/" + document.getElementById("category").value + "/" + GetImageName(array2D[i][j+1]) + ".png";
                            img.className = "tableimg";
                            tabCell.innerHTML = img.outerHTML + "<a href=\"" + array2D[i][j+1] + "\">"+array2D[i][j]+"</a>";
                            j++;
                        }
                        else{
                            tabCell.innerHTML = array2D[i][j];
                        }
                    }
                }
            }

            // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
            var divContainer = document.getElementById("showData");
            divContainer.appendChild(table);
        }

        var filtersPrice;
        var fitlersPlatform;

        function UpdateFilterArray(filterName)
        {
            var filterArrayAll = document.getElementsByName(filterName);
            //console.log(filterArrayAll);
            var filterArrayCurrent = [];
            for(var i = 0; i < filterArrayAll.length; i++)
            {
                if(filterArrayAll[i].checked == true)
                {
                    filterArrayCurrent.push(filterArrayAll[i].value);
                }
            }
            return filterArrayCurrent;
        }

        function FilterTable()
        {
            filtersPrice = UpdateFilterArray("price");
            fitlersPlatform = UpdateFilterArray("platform");

            filterTableByColumn();
        }


        //added from w3school example, modified for intended function
        function filterTableByColumn() 
        {
            var table, tr, i;
            table = document.getElementById("myTable");
            if(table)
            {
                tr = table.getElementsByTagName("tr");
                for (i = 1; i < tr.length; i++) 
                {
                    if (CheckFilter(filtersPrice, tr, i, 1) && CheckFilter(fitlersPlatform, tr, i, 2))
                    {
                        tr[i].style.display = "";
                    } 
                    else 
                    {
                        tr[i].style.display = "none";
                    }
                }     
            }
        }

        function CheckFilter(filterArr, tr, i, colIndex)
        {
            var td, j, txtValue, isfiltered = false;
            
            td = tr[i].getElementsByTagName("td")[colIndex];
            if(filterArr.length == 0)
            {
                isfiltered = true;
            }
            if (td) 
            {
                // If table column contains any of the filters, set isfiltered to true.
                for(j=0;j<filterArr.length;j++)
                {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toLowerCase().includes(filterArr[j])) 
                    {
                        isfiltered = true;
                        break;
                    } 
                }
            }
            return isfiltered;
        }

        function GetImageName(url)
        {
            // Remove Http
            url = url.replace(/h.*?\/\//,"")

            // Split trailing url info
            url = url.split('/');
            
            // Return the image name.
            //console.log(url[0]);
            return url[0];
        }

        function SetTableName()
        {
            var header = document.getElementById("tname");
            var category = document.getElementById("category");
            header.innerHTML = category.options[category.selectedIndex].text;
        }

        function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
        }
        async function imgPlaceholder()
        {
            await sleep(2000); 
            var imgs = document.getElementsByTagName("img");
            for(var z=0; z < imgs.length; z++)
            {
                if(imgs[z].naturalWidth === 0)
                {
                    console.log(imgs[z].naturalWidth);
                    imgs[z].src="images/placeholder.png";
                }                
            }
        }

        //Code to reset the selection autofill for Chrome and Brave browsers.
        const ua = window.navigator.userAgent.toLowerCase();
        const isChrome = /chrome|crios/.test(ua) && ! /edge|opr\//.test(ua)
        const isBrave = isChrome && !window.googletag;
        console.log(isChrome);
        console.log(isBrave);
        if(isChrome || isBrave){
                document.getElementById("emptyCategory").style.display = "";
                setTimeout(function(){resetcat();}, 10) ;
        }
        function resetcat(){
            if(document.getElementById("category").selectedIndex != 0){
                console.log("reset");
                document.getElementById("category").selectedIndex = 0;
            }
        }
    </script>
</html>
<script src="sidebar.js"></script> 
